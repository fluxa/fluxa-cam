extends ../layouts/default

block pages
	.app-page(data-page='home')
		//- .app-topbar
		//- 	.app-title fluxa-cam
		.app-content
			.app-section#image
				img(src='img/cam.gif').cam-img
			.app-section
				.app-button.green#btCapture Capture

block scripts
	script(src='js/spin.min.js')
	script.
		var spinner;
		App.controller('home', function (page) {
			// Setup buttons
			$(page).find('#btCapture').on('click', function(){
				spinnerSpin();
				$.post('/capture', {}, function(data) {
					var imgPath = 'img/temp/cam.gif';
					if(data && data.success) {
						imgPath = 'img/temp/'+data.filename+'?ts='+data.ts;
					}
					$('.cam-img')
					.on('load', function(){
						spinnerStop();
					})
					.attr('src',imgPath);
				})
			});	
		});
		
		try {
			App.restore();
		} catch (err) {
			App.load('home');
		}
		
		function spinnerSpin() {
			var opts = {
				lines: 9, // The number of lines to draw
				length: 40, // The length of each line
				width: 30, // The line thickness
				radius: 44, // The radius of the inner circle
				corners: 1, // Corner roundness (0..1)
				rotate: 0, // The rotation offset
				direction: 1, // 1: clockwise, -1: counterclockwise
				color: '#FFF', // #rgb or #rrggbb or array of colors
				speed: 1, // Rounds per second
				trail: 10, // Afterglow percentage
				shadow: false, // Whether to render a shadow
				hwaccel: true, // Whether to use hardware acceleration
				className: 'spinner', // The CSS class to assign to the spinner
				zIndex: 2e9, // The z-index (defaults to 2000000000)
				top: '50%', // Top position relative to parent
				left: '50%' // Left position relative to parent
			};
			var target = $('#image')[0];
			spinner = new Spinner(opts).spin(target);
		}
		
		function spinnerStop() {
			spinner.stop();
			spinner = null;
		}

		(function(){
			
			
		})();
